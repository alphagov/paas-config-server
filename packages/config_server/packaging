# abort script on any command that exits with a non zero value
set -e -x

export GOROOT=$(readlink -nf /var/vcap/packages/golang)
export GOPATH=$PWD
export PATH=$GOROOT/bin:$PATH

mkdir $BOSH_INSTALL_TARGET/bin

mkdir -p src
mv config_server yaml src

# Compile and install the yaml library
go install yaml

# Compile config-server
go build -o $BOSH_INSTALL_TARGET/bin/config-server config_server
